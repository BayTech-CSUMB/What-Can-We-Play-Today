<%- include('partials/header.ejs') %>
<%- include('partials/navbar.ejs') %>
<%- include('partials/tempNav.ejs') %>

<!-- This file and route are called EMPTY ROOM but it's only technically empty for the first user. After more users join it'll change dynamically with Javascript -->
<div class="background-box">
    <h1>
        EMPTY ROOM PAGE
    </h1>
    <h2 id="toGrab">
        <%= username %>
    </h2>
    <input type = "text" id = "steamID">  

    <input type = "text" class = "message">
    <body onload = "sendMessage()">
    <a href = "/list">
    <button> Generate List </button>
    </a>

    <div id="toGen">
    </div>
</div>

<script>
    // window.onload = sendMessage();
    // TODO: Remember the WAN IP when using LiveShare.
    const socket = io('http://localhost:3000'); //config.url
    socket.on('connection');
    
    socket.on('connection', () => {
        let temp = [];
        temp.push(Cookies.get('steamID'));
        temp.push(Cookies.get('username'));
        temp.push(Cookies.get('avatar'));
        socket.emit('message', temp);
    });

    console.log(Cookies.get('steamID'));
    const sendMessage = () => {
        //let temp = document.querySelector("#toGrab").textContent;
        let temp = [];
        
        let steamID = Cookies.get('steamID');
        let username = Cookies.get('username');
        let avatar = Cookies.get('avatar');
        socket.emit('message', {steamID: steamID, username: username, avatar: avatar});
        // temp.push(Cookies.get('steamID'));
        // temp.push(Cookies.get('username'));
        // temp.push(Cookies.get('avatar'));
        // socket.emit('message', temp);
    }
    socket.on('otherMsg', (data) => {
        console.log(data);

        //Setup the image div with the first user that joins
        let divAppend = document.getElementById('toGen');
        let current = `<img src = "${data[0].avatar}"">`;
        divAppend.innerHTML = current;

        //Appends other users that join to the image div
        for (let i = 1; i < data.length; i++){
            let HTML = `<img src = "${data[i].avatar}"">`;
            current += HTML;
            divAppend.innerHTML = current;
        }
    });
</script>